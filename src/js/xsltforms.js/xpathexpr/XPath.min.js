/*
 LGPL - See file 'LICENSE.md' in this project.
 @module XPath
 @description  === XsltForms_xpath Class ===
 XPath Class
 * constructor function : initializes properties and creates an associated namespace resolver. A compiled argument as string is interpreted as an error detected by the XSLT transformation.
*/
'use strict';function XsltForms_xpath(a,b){this.subform=a;a.xpaths.push(this);this.expression=b;try{var c=Fleur.XPathEvaluator._xp2js(b,"","");eval("arr = "+c+";");c=Fleur.minimal?XsltForms_FleurConv[(void 0)[0]]((void 0)[1]):(new Fleur.Transpiler("ctx","  ")).funcdef(void 0);c=eval(c)}catch(g){alert("XSLTForms Exception\n--------------------------\n\nError parsing the following XPath expression :\n\n"+b+"\n\n"+g.message);return}this.compiled=c;this.nsresolver=new Fleur.XPathNSResolver;a.expressions[b]=
this;this.evaltime=0}XsltForms_xpath.prototype.evaluate=function(){alert("XPath error")};
XsltForms_xpath.prototype.xpath_evaluate=function(a,b,c,g){var h=new Date;XsltForms_browser.assert(a);a.node?a.nsresolver||(a.nsresolver=this.nsresolver):a=new XsltForms_exprContext(c,a,null,null,null,this.nsresolver,b,g);try{var d=Fleur.minimal?this.compiled.evaluate(a):this.compiled(new Fleur.Context(a.node,{nsresolver:a.nsresolver},a.depsNodes,a.depsElements,a.position)).item;if(this.unordered&&d instanceof Array&&1<d.length){a=[];b=0;for(var e=d.length;b<e;b++)a.push({count:XsltForms_browser.selectNodesLength("preceding::* | ancestor::*",
d[b]),node:d[b]});a.sort(function(f,k){return f.count-k.count});e=0;for(var l=a.length;e<l;e++)d[e]=a[e].node}this.evaltime+=new Date-h;return d}catch(f){return alert("XSLTForms Exception\n--------------------------\n\nError evaluating the following XPath expression :\n\n"+this.expression+"\n\n"+(f.name?f.name+"\n\n"+f.message:f)),null}};XsltForms_xpath.notfound=!1;XsltForms_xpath.create=function(a,b){var c=a.expressions[b];c||(c=new XsltForms_xpath(a,b));return c};
XsltForms_xpath.prototype.dispose=function(){delete this.subform.expressions[this.expression]};XsltForms_xpath.registerNS=function(a,b){if(XsltForms_xpath.notfound){XsltForms_xpath.notfound=!1;for(var c in XsltForms_xpath.expressions)XsltForms_xpath.expressions.hasOwnProperty(c)&&(XsltForms_xpath.expressions[c].nsresolver.registerNotFound(a,b),XsltForms_xpath.expressions[c].nsresolver.notfound&&(XsltForms_xpath.notfound=!0))}};